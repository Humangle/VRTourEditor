<html>
	<head>
		<script  type="importmap">
			{
				"imports": {
					"three": "https://threejs.org/build/three.module.js",
					"three/addons/" : "https://threejs.org/examples/jsm/"
				}
			}
		</script>
		<script type="module">
			import * as THREE from 'three';
			import {OrbitControls} from 'three/addons/controls/OrbitControls.js';
			
			let ready = false; //state of the software
			
			let main = () => {
				//set up the canvas for THREE.js
				const canvas = document.getElementById("c");
				const renderer = new THREE.WebGLRenderer({antialias: true, canvas});
				renderer.setPixelRatio(window.devicePixelRatio);
				
				//set the camera up
				const fov = 90;
				const aspect = 2;
				const near = 0.1;
				const far = 5;
				const camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
				camera.position.z = 2;
				
				//orbital camera controls
				const controls = new OrbitControls(camera, renderer.domElement);
				controls.enableDamping = true;
				controls.minDistance = 1.1;
				controls.maxDistance = 2;
				
				//here we go!
				const scene = new THREE.Scene();
				
				//loading textures
				const loadingElem = document.querySelector('#loading');
				const progressBarElem = loadingElem.querySelector('.progressbar');
				const loadManager = new THREE.LoadingManager();
				const loader = new THREE.TextureLoader(loadManager);
				
				const radius = 1;
				const widthSegments = 32;
				const heightSegments = 24;
				const sphereGeometry = new THREE.SphereGeometry(radius, widthSegments, heightSegments);
				
				const EarthDayTexture = loader.load('https://raw.githubusercontent.com/LearningMike/360images/main/2k_earth_daymap.jpg');
				const EarthNightTexture = loader.load('https://raw.githubusercontent.com/LearningMike/360images/main/2k_earth_nightmap.jpg');
				const sphereMaterialEarth = new THREE.MeshPhongMaterial({map: EarthDayTexture});
				let sphereMesh;
				 
				loadManager.onLoad = () => {
					loadingElem.style.display = 'none';
					sphereMesh = new THREE.Mesh(sphereGeometry, sphereMaterialEarth);
					scene.add(sphereMesh);
					ready = true;
				};
				
				loadManager.onProgress = (urlOfLastItemLoaded, itemsLoaded, itemsTotal) => {
					const progress = itemsLoaded / itemsTotal;
					progressBarElem.style.transform = `scaleX(${progress})`;
				};
				
				const color = 0xFFFFFF;
				const intensity = 1;
				const light = new THREE.DirectionalLight(color, intensity);
				light.position.set(0, 0, 4);
				scene.add(light);
				
				let render = (time) => {
					time *= 0.001; // convert time to seconds
					
					if (ready){
						sphereMesh.rotation.y = time/2;
					}
					
					if (time > 5){
						sphereMaterialEarth.map = EarthNightTexture;
					}
					
					renderer.render(scene, camera);
					
					requestAnimationFrame(render);
				}
				requestAnimationFrame(render);
			}
			main();
		</script>
		<link rel="stylesheet" href="main.css" />
	</head>
	<body>
		<div id="loading">
			<div class="progress"><div class="progressbar"></div></div>
		</div>
		<canvas id="c" height="600" width="1200">
		</canvas>
	</body>
</html>